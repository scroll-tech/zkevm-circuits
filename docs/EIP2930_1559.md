---
tags: scroll documentation
---

# EIP 2930 & 1559
this doc describles how to support EIP2930 & 1559.
## links
  - EIP2930 https://eips.ethereum.org/EIPS/eip-2930
  - EIP1559 https://eips.ethereum.org/EIPS/eip-1559

## copy circuit
    - EIP2030 generates copy event for variable length of access list items (two types: address, storage key),so copy circuit need to handle such situation.
    - added two additinonal `CopyDataType`: 
    /// When copy event is access-list addresses (EIP-2930), source is tx-table
    /// and destination is rw-table.
    AccessListAddresses,
    /// When copy event is access-list storage keys (EIP-2930), source is
    /// tx-table and destination is rw-table.
    AccessListStorageKeys,
     - constraints: 
       - `constrain_tag` method include new `is_access_list_address`, `is_access_list_storage_key` constraint.
       - Tx access list address lookup(tx table with `TxContextFieldTag::AccessListAddress`)
       - Rw access list address lookup(rw table with `RwTableTag::TxAccessListAccount`)
       - Tx access list storage key lookup (tx table with `TxContextFieldTag::AccessListStorageKey`)
       - Rw access list storage key lookup (rw table with `RwTableTag::TxAccessListAccountStorage`)

 ### evm circuit
   - buss mapping: added method in `bus-mapping/src/evm/opcodes/begin_end_tx.rs``add_access_list_address_copy_event`, `add_access_list_storage_key_copy_event` to generate copy events which copy circuit handles.
   -`TxAccessListGadget` : handle access-list for EIP-1559 and EIP-2930
    - fields: 
     - is_eip1559_tx: check if 1559 tx type
     - is_eip2930_tx: check if 2930 tx type
     - is_address_len_zero: check if contiains no access list address (AccessListAddressesLen == 0)
     - address_len: length of access list addresses
     - storage_key_len: length of storage keys under one access list address item
    - constaints:
     - tx table lookups for [AccessListAddressesLen, AccessListStorageKeysLen]
     - copy table lookups for tx-table's access list addresses(CopyDataType::AccessListAddresses) when is_address_len_zero not true. 
     - copy table lookups for tx-table's access list storage keys (CopyDataType::AccessListStorageKeys) when is_storage_key_len_zero not true 
   -`TxEip1559Gadget`: gadget to check sender balance before transfer
    - fields:
     - is_eip1559_tx: check if 1559 tx type
     - gas_fee_cap: MaxFeePerGas in 1559
     - gas_tip_cap: MaxPriorityFeePerGas in 1559
     - mul_gas_fee_cap_by_gas: calculate total gas amount
     - balance_check: calculate minimal caller's balance required = mul_gas_fee_cap_by_gas + tx.value + tx_l1_fee
     - is_insufficient_balance: check balance is sufficient compared to 
      minimal balance required.
     - gas_fee_cap_lt_gas_tip_cap: make sure gas_fee_cap not less than gas_tip_gap.
    - constraints:
     - tx table lookups for [MaxFeePerGas, MaxPriorityFeePerGas]
     - sender balance must be sufficient, and gas_fee_cap >= gas_tip_cap
   - `begin_tx` : take use of `TxAccessListGadget` and `TxEip1559Gadget` to implement corresponding constraints. 


